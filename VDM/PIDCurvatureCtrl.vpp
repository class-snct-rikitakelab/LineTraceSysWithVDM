--
-- THIS FILE IS AUTOMATICALLY GENERATED!!
--
-- Generated at 12-Jan-14 by the UML-VDM++ Link
--
class PIDCurvatureCtrl

instance variables
  private bfDeviation : real;
  private ctrlMethodParm : [PIDCurvatureCtrlParm];
  private integratedDeviation : real;
  private lastMeasurementTime : real;

operations
  public PIDCurvatureCtrl : () ==> PIDCurvatureCtrl
  PIDCurvatureCtrl() ==
    skip;
  
  public reset : () ==> ()
  reset() ==
    (
    bfDeviation :=0;
    integratedDeviation :=0;
    lastMeasurementTime :=0;
    );

  public getPIDCurvatureCtrlParm : () ==> PIDCurvatureCtrlParm
  getPIDCurvatureCtrlParm() ==
    return ctrlMethodParm;

  public calcCurvatureCtrlVal : real * real * int ==> int
  calcCurvatureCtrlVal(targCurvature, curvature, time) ==
    def 
    deviation = targCurvature - curvature;
    d_deviation = (bfDeviation - deviation)
    in
    (
    integratedDeviation := integratedDeviation + deviation*(time - lastMeasurementTime);
    bfDeviation := deviation;
    lastMeasurementTime := time;
    return deviation*ctrlMethodParm.getCKp() + integratedDeviation*ctrlMethodParm.getCKi() + d_deviation * ctrlMethodParm.getCKd();
    );

  public setPIDCurvatureCtrlParm : PIDCurvatureCtrlParm ==> ()
  setPIDCurvatureCtrlParm(parm) ==
    ctrlMethodParm := parm

end PIDCurvatureCtrl



