--
-- THIS FILE IS AUTOMATICALLY GENERATED!!
--
-- Generated at 12-Jan-14 by the UML-VDM++ Link
--
class PIDLightValCtrl

instance variables
  private PIDParm : [PIDLVCParm];
  private bfDeviation : real :=0;
  private integratedDeviation : real:=0;
  private lastMeasurementTime : real:=0;

operations

  public PIDLightValCtrl : PIDLVCParm ==> PIDLightValCtrl
  PIDLightValCtrl(parm) ==
    (
    PIDParm := parm;
    bfDeviation :=0;
    integratedDeviation :=0;
    lastMeasurementTime :=0;
    );
    
  public reset : () ==> ()
  reset() ==
    (
    bfDeviation :=0;
    integratedDeviation :=0;
    lastMeasurementTime :=0;
    );

  public getCtrlParm : () ==> PIDLVCParm
  getCtrlParm() ==
    return PIDParm;

  public calcLightValCtrlVal : int * int * real ==> int
  calcLightValCtrlVal(targLightVal, lightVal, time) ==
    def 
    deviation = targLightVal - lightVal;
    d_deviation = (bfDeviation - deviation)
    in
    (
    integratedDeviation := integratedDeviation + deviation*(time - lastMeasurementTime);
    bfDeviation := deviation;
    lastMeasurementTime := time;
    return deviation*PIDParm.getLKp() + integratedDeviation*PIDParm.getLKi() + d_deviation * PIDParm.getLKd();
    );

  public setCtrlParm : PIDLVCParm ==> ()
  setCtrlParm(parm) ==
    PIDParm := parm;
    
sync
mutex(calcLightValCtrlVal);
end PIDLightValCtrl



